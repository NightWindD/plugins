apiVersion: plugins.kubegems.io/v1beta1
kind: Plugin
metadata:
  name: nacos
  namespace: "{{ .Release.Namespace }}"
spec:
  kind: helm
  url: https://github.com/nacos-group/nacos-k8s.git
  path: helm
  version: master
  values:
    namespace: {{ .Release.Namespace }}
    global:
      mode: {{ .Values.nacos.mode | default('cluster') }}
    service:
      type: ClusterIP
    nacos:
      replicaCount: {{ .Values.nacos.replicasCount | default('1') }}
      image:
        # repository: nacos/nacos-server
        {{ include "common.images.repository" ( dict "registry" "docker.io" "repository" "nacos/nacos-server" "context" .) }}
        tag: v{{ .Chart.AppVersion }}
      plugin:
        image:
          # repository: nacos/nacos-peer-finder-plugin
          {{ include "common.images.repository" ( dict "registry" "docker.io" "repository" "nacos/nacos-peer-finder-plugin" "context" .) }}
    {{- if .Values.nacos.persistence.enabled }}
    persistence:
      enabled: true
      data:
        storageClassName: {{ .Values.global.storageClass }}
      resources:
        requests:
          storage: {{ .Values.nacos.persistence.size | default('5Gi')}}
    {{- end }}